<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <title>Maze game</title>
</head>
<body>
<div class="btn-div">
<button class="play-btn" id="playButton"  style="height:50px;" onclick="getAccel()"><h2>Play game!</h2></button>
</div>
<canvas id="myCanvas" width="500" height="500" style="border:1px solid #000000;">
    Your browser does not support the HTML canvas tag.
</canvas>
<div></div>

<script>

    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    const ball = {
        centerX: canvas.width / 2,
        centerY: canvas.height / 2,
        radius: 5,
        fillColor: 'red',
    };
    function drawBall() {
        ctx.fillStyle = ball.fillColor;
        ctx.beginPath();
        ctx.arc(ball.centerX, ball.centerY, ball.radius, 0, 2 * Math.PI);
        ctx.fill();
    };

    function drawLogo() {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 200;
    ctx.strokeStyle = 'rgb(0, 0, 255)';
    ctx.lineWidth = 10;
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.stroke();
    };

    // function createCollisionPixels() {
    //     ctx.fillStyle = 'black';
    //     ctx.fillRect(ball.centerX, ball.centerY - ball.radius - 2, 1, 1);
    //     ctx.fillRect(ball.centerX + ball.radius + 2, ball.centerY, 1, 1);
    //     ctx.fillRect(ball.centerX, ball.centerY + ball.radius + 2, 1, 1);
    //     ctx.fillRect(ball.centerX - ball.radius - 2, ball.centerY, 1, 1);
    // }

    function drawMaze() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawLogo();
        drawBall();
        // createCollisionPixels();
    }

    function checkCollision() {
        const topPixelData = ctx.getImageData(ball.centerX, ball.centerY - ball.radius - 4, 1, 1).data.slice(0, 3);
        const rightPixelData = ctx.getImageData(ball.centerX + ball.radius + 4, ball.centerY, 1, 1).data.slice(0, 3);
        const bottomPixelData = ctx.getImageData(ball.centerX, ball.centerY + ball.radius + 4, 1, 1).data.slice(0, 3);
        const leftPixelData = ctx.getImageData(ball.centerX - ball.radius - 4, ball.centerY, 1, 1).data.slice(0, 3);

        const bluePixel = [0, 0, 255];

        return {
            topPixel: topPixelData.every((value, index) => value === bluePixel[index]),
            rightPixel: rightPixelData.every((value, index) => value === bluePixel[index]),
            bottomPixel: bottomPixelData.every((value, index) => value === bluePixel[index]),
            leftPixel: leftPixelData.every((value, index) => value === bluePixel[index]),
        };
    }

    document.addEventListener('keydown', function(event) {
        const collision = checkCollision();
        if (event.key === 'ArrowUp' && !collision.topPixel) {
            ball.centerY -= 5;
        }
        if (event.key === 'ArrowRight' && !collision.rightPixel) {
            ball.centerX += 5;
        }
        if (event.key === 'ArrowDown' && !collision.bottomPixel) {
            ball.centerY += 5;
        }
        if (event.key === 'ArrowLeft' && !collision.leftPixel) {
            ball.centerX -= 5;
        }
        drawMaze();
    });
    function getAccel(){
        DeviceMotionEvent.requestPermission().then(response => {
            if (response === 'granted') {
                window.addEventListener('deviceorientation',(event) => {
                    const collision = checkCollision();
                    const frontToBack = event.beta;
                    const leftToRight = event.gamma;
                    if (frontToBack > 0 && !collision.topPixel) {
                        ball.centerY += Math.min(10, Math.max(-10, Math.round(frontToBack)/2));
                    }
                    if (frontToBack < 0 && !collision.bottomPixel) {
                        ball.centerY += Math.min(10, Math.max(-10, Math.round(frontToBack)/2));
                    }
                    if (leftToRight > 0 && !collision.rightPixel) {
                        ball.centerX += Math.min(10, Math.max(-10, Math.round(leftToRight)/2));
                    }
                    if (leftToRight < 0 && !collision.leftPixel) {
                        ball.centerX += Math.min(10, Math.max(-10, Math.round(leftToRight)/2));
                    }
                    drawMaze();
                });
            };
        });
    };
    drawMaze();
</script>
</body>
</html>
