<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <title>Maze game</title>
</head>
<body>
<div class="btn-div">
<button class="play-btn" id="playButton"  style="height:50px;" onclick="getAccel()"><h2>Play game!</h2></button>
</div>
<canvas id="myCanvas" width="500" height="500" style="border:1px solid #000000;">
    Your browser does not support the HTML canvas tag.
</canvas>
<div></div>

<script>

    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    const ball = {
        centerX: canvas.width / 2,
        centerY: canvas.height / 2,
        radius: 10,
        fillColor: 'red',
    };
    function drawBall() {
        ctx.fillStyle = ball.fillColor;
        ctx.beginPath();
        ctx.arc(ball.centerX, ball.centerY, ball.radius, 0, 2 * Math.PI);
        ctx.fill();
    }

    const obstacleColour = [0, 0, 0];

    function drawBoundary() {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 200;
    ctx.fillStyle = 'white'
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 10;
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.fill();
    }

    function drawCenterRectangle() {
        const rectHeight = 40;
        const rectWidth = canvas.width - 120;
        const rectX = (canvas.width - rectWidth) / 2;
        const rectY = (canvas.height - rectHeight) / 2;
        ctx.fillStyle = 'white';
        ctx.fillRect(rectX, rectY, rectWidth, rectHeight);
    }

    function drawMaze() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const img = new Image();
        const imgSize = 240;
        img.onload = function () {
            drawBoundary();
            ctx.drawImage(img, (canvas.width / 2)-(imgSize / 2), (canvas.width / 2)-(imgSize / 2), imgSize, imgSize);
            drawCenterRectangle();
            drawBall();
        }
        img.src = 'insta-logo.png';
    }
    function checkIfCollide(accelX, accelY) {
        for (let angle  = 0; angle < 360; angle += 10) {
        const xCoordinate = (ball.centerX + accelX) + (ball.radius) * Math.cos(angle * (Math.PI / 180));
        const yCoordinate = (ball.centerY + accelY) + (ball.radius) * Math.sin(angle * (Math.PI / 180));
        const checkColour =  ctx.getImageData(xCoordinate -0.5, yCoordinate -0.5, 1, 1).data.slice(0, 3);
        if (checkColour.every((value, index) => value === obstacleColour[index])){
            return true;
        }
    }
        return false;
    }


    function getAccel() {
        ball.centerX = canvas.width / 2;
        ball.centerY = canvas.height / 2;
        const XScalingFactor = 2;
        const YScalingFactor = 4;
        const maxAccel = 4;
        const minAccel = -4;

        DeviceMotionEvent.requestPermission().then(response => {
            if (response === 'granted') {
                window.addEventListener('devicemotion', (event) => {
                    let accelX = event.accelerationIncludingGravity.x * XScalingFactor;
                    let accelY = -event.accelerationIncludingGravity.y * YScalingFactor;

                    accelX = Math.min(maxAccel, Math.max(minAccel, accelX));
                    accelY = Math.min(maxAccel, Math.max(minAccel, accelY));

                    const willCollide = checkIfCollide(accelX, accelY);
                    if (!willCollide) {
                        ball.centerX += accelX;
                        ball.centerY += accelY;
                    }
                    drawMaze();
                });
            }
        });
    }
    drawMaze();
</script>
</body>
</html>
